<Page x:Class="PiggyBankAdmin.Views.Pages.TransactionsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Транзакции"
      MinHeight="150" MinWidth="550">

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Заголовок и фильтры -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <TextBlock Text="💳 Управление транзакциями" 
                       FontSize="18" FontWeight="Bold" 
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Панель фильтров -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
            <ComboBox Name="TypeFilterComboBox" Width="120" 
                      SelectionChanged="Filter_SelectionChanged">
                <ComboBoxItem Content="Все типы" IsSelected="True"/>
                <ComboBoxItem Content="Доходы"/>
                <ComboBoxItem Content="Расходы"/>
            </ComboBox>

            <DatePicker Name="StartDatePicker" Width="120" 
                       Margin="10,0,0,0"
                       SelectedDateChanged="DateFilter_Changed"/>
            <TextBlock Text="по" VerticalAlignment="Center" 
                       Margin="5,0,5,0"/>
            <DatePicker Name="EndDatePicker" Width="120"
                       SelectedDateChanged="DateFilter_Changed"/>

            <Button Content="🔍 Применить" 
                    Click="ApplyFilters_Click"
                    Background="#1A946F" Foreground="White" 
                    Margin="10,0,0,0" Padding="10,5"/>

            <Button Content="🔄 Обновить" 
                    Click="RefreshTransactions_Click"
                    Background="#1A946F" Foreground="White" 
                    Margin="10,0,0,0" Padding="10,5"/>

            <Button Content="📤 Экспорт CSV" 
                    Click="ExportTransactions_Click"
                    Background="#114B5F" Foreground="White" 
                    Margin="10,0,0,0" Padding="10,5"/>
            <Button Content="➕ Добавить транзакцию" 
        Click="AddTransaction_Click"
        Background="#88D398" Foreground="White" 
        Margin="20,0,0,0" Padding="10,5"/>
        </StackPanel>

        <!-- Таблица транзакций -->
        <DataGrid Grid.Row="2" Name="TransactionsGrid" 
                  AutoGenerateColumns="False"
                  IsReadOnly="True">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>

                <DataGridTextColumn Header="Пользователь" 
                                   Binding="{Binding UserName}" Width="120"/>

                <DataGridTextColumn Header="Сумма" Width="100">
                    <DataGridTextColumn.Binding>
                        <Binding Path="Amount" StringFormat="{}{0}₽"/>
                    </DataGridTextColumn.Binding>
                </DataGridTextColumn>

                <DataGridTextColumn Header="Тип" 
                                   Binding="{Binding TypeDisplay}" Width="80"/>

                <DataGridTextColumn Header="Описание" 
                                   Binding="{Binding Description}" Width="200"/>

                <DataGridTextColumn Header="Дата" 
                                   Binding="{Binding Date, StringFormat=dd.MM.yyyy}" 
                                   Width="100"/>

                <DataGridCheckBoxColumn Header="Повтор" 
                                       Binding="{Binding IsRecurring}" 
                                       Width="60"/>

                <DataGridTemplateColumn Header="Действия" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="✏️" Click="EditTransaction_Click" 
                                        Tag="{Binding Id}" Margin="2" Padding="5"
                                        ToolTip="Редактировать"/>
                                <Button Content="🗑️" Click="DeleteTransaction_Click" 
                                        Tag="{Binding Id}" Margin="2" Padding="5"
                                        Background="LightCoral" 
                                        ToolTip="Удалить"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>

            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Foreground" 
                            Value="{Binding AmountColor}"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>
    </Grid>
</Page>